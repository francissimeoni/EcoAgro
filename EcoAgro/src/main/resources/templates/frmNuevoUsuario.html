<html lang="es">

<head>
    <meta charset="UTF-8" />
    <title>Crear Usuario</title>
    <meta name="viewport"
        content="width=device-width, user-scalable=yes, initial-scale=1.0, maximum-scale=3.0, minimum-scale=1.0" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" />
    <link rel="stylesheet" href="/css/formularios.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="/css/Styles.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">


</head>

<body>

    <body>

        <div th:if="${sesion != 'admin'}">
            <header th:replace="/fragments/header::header"></header>
        </div>
        <header sec:authorize="hasAnyRole('ADMINISTRADOR', 'PRODUCTOR')"
            th:replace="/fragments/HeaderLogueado::headerLogueado"></header>
        </head>

        <form class="formulario" action="/PersistirUsuario" method="POST">
            <h1>Registrate</h1>

            <div class="contenedor">
                <div class="input-contenedor">
                    <i class="fas fa-user icon"></i>
                    <input type="text" name="usr" placeholder="Nombre Completo" />
                </div>



                <select onchange="trasladarValor();" th:object="${z}" id="selectZona" style="border-radius: 0%;"
                    class="form-select form-select-lg mb-3" aria-label=".form-select-lg example">
           <option selected></option>
                    <option th:each="z : ${zonas}" th:value="${z.idZonas}" th:text="${z.nombre}"></option>
                </select>

                <input type="text" id="rs" name="zona" >

                <div class="input-contenedor">
                    <i class="fas fa-regular fa-compass icon"></i>
                    <input type="text" placeholder="Ciudad" />
                </div>

                <div class="input-contenedor">
                    <i class="fas fa-regular fa-compass icon"></i>
                    <input type="text" placeholder="telefono" name="telefono" />
                </div>
                <span id="emailV" style="color: red; font-size: small ;">Introduzca un email válido</span>



                <div class="input-contenedor">
                    <i class="fas fa-envelope icon"></i>
                    <input type="text" name="email" placeholder="E-Mail" />
                </div>
                <span id="passV1" style="color: red; font-size: small ;">La contraseña debe tener al menos 8 caracteres,
                    una mayuscula y 1 signo</span>


                <div class="input-contenedor">
                    <i class="fas fa-key icon"></i>
                    <input id="ps1" type="password" name="pass" placeholder="Contraseña"
                        onkeyup="ContraseñaCaracteresEspeciales();" />
                </div>

                <span id="passV2" style="color: red; font-size: small ;">La contraseña debe tener al menos 8 caracteres,
                    una mayuscula y 1 signo</span>

                <div class="input-contenedor">
                    <i class="fas fa-key icon"></i>
                    <input id="ps2" type="text" placeholder="Repita la contraseña"
                        onkeyup="chequearIgualdadContraseña()" />
                </div>


                <input type="submit" id="btnGuardar" value="Registrate" class="button" />
                <p>
                    Al registrarte, aceptas nuestras Condiciones de uso y Política de
                    privacidad.
                </p>
                <p>
                    ¿Ya tienes una cuenta?<a class="link" href="/login">Iniciar Sesión</a>
                </p>
            </div>
        </form>

        <script>



            var passH1 = document.getElementById('passV1');
            var passH2 = document.getElementById('passV2');
            var emailH = document.getElementById('emailV');
            var hrH = document.getElementById('rs');
            var pass1 = document.getElementById('ps1');
            var pass2 = document.getElementById('ps2');
            var guardar = document.getElementById('btnGuardar');


            let valPass1 = new Boolean(false);
            let valPass2 = new Boolean(false);
            let valPass3 = new Boolean(false);
            let valPass4 = new Boolean(false);
            let valPass5 = new Boolean(false);

            guardar.hidden = true;
            hrH.hidden = true;
            passH1.hidden = true;
            passH2.hidden = true;
            emailH.hidden = true;

            validacionesCaracteres = {
                password: /^(?=\w*\d)(?=\w*[A-Z])(?=\w*[a-z])\S{8,16}$/,
                noValido : / /
            }

            function MostrarBoton() {
                if (valPass1 == true && valPass2 == true && valPass3 == true && valPass4 == true && valPass5 == true) {
                    guardar.hidden = false;
                } else {
                    guardar.hidden = true;

                }
            }


            function ContraseñaCaracteresEspeciales() {



                if (validacionesCaracteres.password.test(pass1.value)) {

                    
                    passH1.hidden = false;
                    passH1.innerHTML = 'La contraseña cumple con todos los requisitos';
                    passH1.style.color = "green";

                    valPass1 = true;
                    MostrarBoton();


                } else {

                    passH1.hidden = false;
                    passH1.innerHTML = 'La contraseña debe contener al menos un numero, y una mayusculas.';
                    passH1.style.color = "red";
                    valPass1 = false;
                    MostrarBoton();
                }

                if (validacionesCaracteres.noValido.test(pass1.value)) {

                    passH1.hidden = false;
                    passH1.innerHTML = 'La clave no puede contenes espacios';
                    passH1.style.color = "red";
                    valPass2 = false;
                    MostrarBoton();
                } else {

                    valPass2 = true;
                    MostrarBoton();
                }

                if (pass1.value == "") {

                    passH1.hidden = true;
                    valPass3 = false;
                    MostrarBoton();
                } else {

                    valPass3 = true;
                    MostrarBoton();

                }


            }




            function chequearIgualdadContraseña() {

                if (pass1.value != pass2.value) {

                    passH2.hidden = false;
                    passH2.innerHTML = 'Las contraseñas no coinciden';
                    passH2.style.color = "red";

                    valPass4 = false;
                    MostrarBoton();
                } else {

                    passH2.innerHTML = 'Las contraseñas coinciden';
                    passH2.style.color = "green";

                    valPass4 = true;
                    MostrarBoton();
                }

                if (pass2.value == "") {

                    passH2.hidden = false;

                    valPass5 = false;
                    MostrarBoton();
                }
                else {

                    valPass5 = true;
                    MostrarBoton();
                }



            }

            function trasladarValor() {
                var cod = document.getElementById('selectZona').value;
                document.getElementById('rs').value = cod;
            }


        </script>


    </body>

</html>